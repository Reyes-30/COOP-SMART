<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Transacciones - COOP-SMART</title>
    <link rel="stylesheet" href="pagos.css">
    <link rel="stylesheet" href="transacciones.css">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="logo-section">
                <div class="logo-icon">üí∞</div>
                <div>
                    <h1 class="logo-text">COOP-SMART</h1>
                    <p class="logo-subtitle">Sistema de Gesti√≥n Cooperativa</p>
                </div>
            </div>
            
            <div class="header-search">
                <input type="text" id="globalSearch" placeholder="Buscar por pr√©stamo, socio, referencia..." class="search-input">
                <span class="search-icon">ÔøΩ</span>
            </div>
            
            <div class="user-menu">
                <div class="user-info">
                    <span class="user-name" id="userName">Admin</span>
                    <span class="user-role" id="userRole">Administrador</span>
                </div>
                <button class="logout-btn" id="logoutBtn">
                    <span>ÔøΩ</span> Salir
                </button>
            </div>
        </div>
    </header>

    <!-- Navigation -->
    <nav class="nav-menu">
        <a href="dashboard.html" class="nav-link">üìä Dashboard</a>
        <a href="socios.html" class="nav-link">üë• Socios</a>
        <a href="cuentas.html" class="nav-link">ÔøΩ Cuentas</a>
        <a href="prestamos.html" class="nav-link">üíµ Pr√©stamos</a>
        <a href="transacciones.html" class="nav-link active">üìù Transacciones</a>
        <a href="pagos.html" class="nav-link">üí∏ Pagos</a>
        <a href="reportes.html" class="nav-link">üìà Reportes</a>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        <div class="page-header">
            <div>
                <h2 class="page-title">ÔøΩ Transacciones</h2>
                <p class="page-subtitle">Registro y seguimiento de transacciones</p>
            </div>
            <button class="btn-primary" id="btnNuevaTransaccion">
                <span>‚ûï</span> Nueva Transacci√≥n
            </button>
        </div>

        <!-- Stats Cards -->
        <div class="stats-grid">
            <div class="stat-card stat-green">
                <div class="stat-icon">‚¨áÔ∏è</div>
                <div class="stat-info">
                    <div class="stat-label">Total Dep√≥sitos</div>
                    <div class="stat-value" id="totalDepositos">L. 0.00</div>
                    <div class="stat-count" id="countDepositos">0 transacciones</div>
                </div>
            </div>
            <div class="stat-card stat-red">
                <div class="stat-icon">‚¨ÜÔ∏è</div>
                <div class="stat-info">
                    <div class="stat-label">Total Retiros</div>
                    <div class="stat-value" id="totalRetiros">L. 0.00</div>
                    <div class="stat-count" id="countRetiros">0 transacciones</div>
                </div>
            </div>
            <div class="stat-card stat-blue">
                <div class="stat-icon">üí±</div>
                <div class="stat-info">
                    <div class="stat-label">Total Transferencias</div>
                    <div class="stat-value" id="totalTransferencias">L. 0.00</div>
                    <div class="stat-count" id="countTransferencias">0 transacciones</div>
                </div>
            </div>
            <div class="stat-card stat-purple">
                <div class="stat-icon">üìÖ</div>
                <div class="stat-info">
                    <div class="stat-label">Hoy</div>
                    <div class="stat-value" id="transaccionesHoy">0</div>
                    <div class="stat-count" id="montoHoy">L. 0.00</div>
                </div>
            </div>
        </div>

        <!-- Filters Section -->
        <div class="card">
            <div class="card-header">
                <h3>üîç Filtros</h3>
            </div>
            <div class="filters-card">
                <h3 class="filters-title">Filtros</h3>
                <div class="filters-grid">
                    <!-- Tipo de Transacci√≥n -->
                    <div class="filter-group">
                        <label class="filter-label">Tipo</label>
                        <div class="filter-buttons">
                            <button class="filter-chip active" data-tipo="todos">
                                Todos
                            </button>
                            <button class="filter-chip" data-tipo="deposito">
                                ‚¨áÔ∏è Dep√≥sitos
                            </button>
                            <button class="filter-chip" data-tipo="retiro">
                                ‚¨ÜÔ∏è Retiros
                            </button>
                            <button class="filter-chip" data-tipo="transferencia">
                                üí± Transferencias
                            </button>
                        </div>
                    </div>

                    <!-- Rango de Fechas -->
                    <div class="filter-group">
                        <label class="filter-label">Per√≠odo</label>
                        <div class="date-filters">
                            <button class="date-chip active" data-periodo="hoy">Hoy</button>
                            <button class="date-chip" data-periodo="semana">Esta Semana</button>
                            <button class="date-chip" data-periodo="mes">Este Mes</button>
                            <button class="date-chip" data-periodo="custom">Personalizado</button>
                        </div>
                    </div>

                    <!-- Fechas Personalizadas -->
                    <div class="filter-group" id="customDateGroup" style="display: none;">
                        <label class="filter-label">Rango Personalizado</label>
                        <div class="date-inputs">
                            <input type="date" id="fechaDesde" class="date-input">
                            <span style="color: #6B7280;">hasta</span>
                            <input type="date" id="fechaHasta" class="date-input">
                            <button class="btn-apply" id="btnAplicarFechas">Aplicar</button>
                        </div>
                    </div>

                    <!-- Cuenta -->
                    <div class="filter-group">
                        <label class="filter-label">Cuenta</label>
                        <select id="filtroCuenta" class="filter-select">
                            <option value="todas">Todas las cuentas</option>
                        </select>
                    </div>

                    <!-- Monto -->
                    <div class="filter-group">
                        <label class="filter-label">Rango de Monto</label>
                        <div class="monto-inputs">
                            <input type="number" id="montoMin" placeholder="M√≠nimo" class="monto-input" step="0.01">
                            <span style="color: #6B7280;">-</span>
                            <input type="number" id="montoMax" placeholder="M√°ximo" class="monto-input" step="0.01">
                        </div>
                    </div>
                </div>

                <div class="filters-actions">
                    <button class="btn-secondary" id="btnLimpiarFiltros">
                        üîÑ Limpiar Filtros
                    </button>
                    <button class="btn-primary" id="btnAplicarFiltros">
                        üîç Aplicar Filtros
                    </button>
                </div>
            </div>
        </div>

        <!-- Table -->
        <div class="card" style="margin-top: 1.5rem;">
            <div class="card-header">
                <h3>üìã Historial de Transacciones</h3>
                <div class="toolbar">
                    <button class="btn-secondary" id="btnExportarCSV">
                        üìä CSV
                    </button>
                    <button class="btn-secondary" id="btnExportarPDF">
                        üìÑ PDF
                    </button>
                </div>
            </div>
            <div class="table-container">
                <table class="data-table" id="transaccionesTable">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Fecha y Hora</th>
                            <th>Tipo</th>
                            <th>Cuenta</th>
                            <th>Titular</th>
                            <th>Monto</th>
                            <th>Saldo Despu√©s</th>
                            <th>Descripci√≥n</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="transaccionesTableBody">
                        <tr class="loading-row">
                            <td colspan="9">
                                <div class="loading-spinner"></div>
                                <p>Cargando transacciones...</p>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Pagination -->
            <div class="pagination" id="pagination">
                <button class="pagination-btn" id="btnPrevPage" disabled>
                    ‚Üê Anterior
                </button>
                <div class="pagination-info">
                    P√°gina <span id="currentPage">1</span> de <span id="totalPages">1</span>
                </div>
                <button class="pagination-btn" id="btnNextPage" disabled>
                    Siguiente ‚Üí
                </button>
            </div>
        </div>
    </main>

    <!-- Modal: Nueva Transacci√≥n -->
    <div class="modal" id="modalNuevaTransaccion">
        <div class="modal-content modal-medium">
            <div class="modal-header">
                <h2 class="modal-title">Nueva Transacci√≥n</h2>
                <button class="modal-close" id="btnCloseNueva">‚úï</button>
            </div>
            <form id="formNuevaTransaccion">
                <div class="modal-body">
                    <!-- Tipo de Transacci√≥n -->
                    <div class="form-section">
                        <h3 class="section-title">Tipo de Transacci√≥n</h3>
                        <div class="radio-grid">
                            <label class="radio-card">
                                <input type="radio" name="tipo" value="deposito" checked>
                                <div class="radio-content">
                                    <span class="radio-icon">‚¨áÔ∏è</span>
                                    <span class="radio-label">Dep√≥sito</span>
                                </div>
                            </label>
                            <label class="radio-card">
                                <input type="radio" name="tipo" value="retiro">
                                <div class="radio-content">
                                    <span class="radio-icon">‚¨ÜÔ∏è</span>
                                    <span class="radio-label">Retiro</span>
                                </div>
                            </label>
                            <label class="radio-card">
                                <input type="radio" name="tipo" value="transferencia">
                                <div class="radio-content">
                                    <span class="radio-icon">üí±</span>
                                    <span class="radio-label">Transferencia</span>
                                </div>
                            </label>
                        </div>
                    </div>

                    <!-- Cuenta Origen -->
                    <div class="form-section">
                        <div class="form-group">
                            <label for="id_cuenta">Cuenta *</label>
                            <select id="id_cuenta" name="id_cuenta" required>
                                <option value="">Seleccionar cuenta...</option>
                            </select>
                        </div>
                        <div id="cuentaInfo" class="cuenta-info-box" style="display: none;">
                            <div class="cuenta-numero" id="infoCuentaNumero">---</div>
                            <div class="cuenta-titular" id="infoCuentaTitular">---</div>
                            <div class="cuenta-saldo">
                                <span>Saldo disponible:</span>
                                <span id="infoCuentaSaldo">L. 0.00</span>
                            </div>
                        </div>
                    </div>

                    <!-- Cuenta Destino (solo para transferencias) -->
                    <div class="form-section" id="seccionDestino" style="display: none;">
                        <div class="form-group">
                            <label for="id_cuenta_destino">Cuenta Destino *</label>
                            <select id="id_cuenta_destino" name="id_cuenta_destino">
                                <option value="">Seleccionar cuenta destino...</option>
                            </select>
                        </div>
                    </div>

                    <!-- Monto y Descripci√≥n -->
                    <div class="form-section">
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="monto">Monto (L.) *</label>
                                <input type="number" id="monto" name="monto" 
                                       step="0.01" min="0.01" required>
                            </div>
                            <div class="form-group">
                                <label for="descripcion">Descripci√≥n</label>
                                <input type="text" id="descripcion" name="descripcion" 
                                       placeholder="Motivo de la transacci√≥n">
                            </div>
                        </div>
                    </div>

                    <!-- Preview del nuevo saldo -->
                    <div class="preview-box" id="previewBox" style="display: none;">
                        <div class="preview-item">
                            <span class="preview-label">Saldo Actual:</span>
                            <span class="preview-value" id="previewSaldoActual">L. 0.00</span>
                        </div>
                        <div class="preview-arrow">‚Üí</div>
                        <div class="preview-item">
                            <span class="preview-label">Nuevo Saldo:</span>
                            <span class="preview-value highlight" id="previewNuevoSaldo">L. 0.00</span>
                        </div>
                    </div>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn-secondary" id="btnCancelarNueva">Cancelar</button>
                    <button type="submit" class="btn-primary">
                        <span class="btn-icon">üíæ</span>
                        Procesar Transacci√≥n
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal: Detalles de Transacci√≥n -->
    <div class="modal" id="modalDetalles">
        <div class="modal-content modal-medium">
            <div class="modal-header">
                <h2 class="modal-title">Detalles de la Transacci√≥n</h2>
                <button class="modal-close" id="btnCloseDetalles">‚úï</button>
            </div>
            <div class="modal-body">
                <div class="detalles-header">
                    <div class="detalles-icon" id="detallesIcono">üí∞</div>
                    <div class="detalles-info">
                        <h3 id="detallesTipo">---</h3>
                        <p id="detallesFecha">---</p>
                    </div>
                    <div class="detalles-monto">
                        <div class="monto-transaccion" id="detallesMonto">L. 0.00</div>
                    </div>
                </div>

                <div class="detalles-grid" id="detallesContenido">
                    <!-- Se llenar√° din√°micamente -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" id="btnCerrarDetalles">Cerrar</button>
                <button class="btn-primary" id="btnImprimirRecibo">
                    <span class="btn-icon">üñ®Ô∏è</span>
                    Imprimir Recibo
                </button>
            </div>
        </div>
    </div>

    <script src="dashboard.js"></script>
    <script src="transacciones.js"></script>
</body>
</html>
