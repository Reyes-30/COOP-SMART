<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pr√©stamos - COOP-SMART</title>
    <link rel="stylesheet" href="dashboard.css">
    <link rel="stylesheet" href="prestamos.css">
</head>
<body>
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="logo">
                <span class="logo-icon">üè¶</span>
                <span class="logo-text">COOP-SMART</span>
            </div>
            <button class="sidebar-toggle" id="sidebarToggle">
                <span class="toggle-icon">‚ò∞</span>
            </button>
        </div>

        <nav class="sidebar-nav">
            <a href="dashboard.html" class="nav-item">
                <span class="nav-icon">üìä</span>
                <span class="nav-text">Dashboard</span>
            </a>
            <a href="socios.html" class="nav-item">
                <span class="nav-icon">üë•</span>
                <span class="nav-text">Socios/Clientes</span>
            </a>
            <a href="cuentas.html" class="nav-item">
                <span class="nav-icon">üí∞</span>
                <span class="nav-text">Cuentas</span>
            </a>
            <a href="prestamos.html" class="nav-item active">
                <span class="nav-icon">üí≥</span>
                <span class="nav-text">Pr√©stamos</span>
            </a>
            <a href="transacciones.html" class="nav-item">
                <span class="nav-icon">üîÑ</span>
                <span class="nav-text">Transacciones</span>
            </a>
            <a href="pagos.html" class="nav-item">
                <span class="nav-icon">üíµ</span>
                <span class="nav-text">Pagos</span>
            </a>
            <a href="reportes.html" class="nav-item">
                <span class="nav-icon">üìà</span>
                <span class="nav-text">Reportes</span>
            </a>
        </nav>

        <div class="sidebar-footer">
            <div class="user-info">
                <div class="user-avatar">üë§</div>
                <div class="user-details">
                    <div class="user-name" id="userName">Admin</div>
                    <div class="user-role" id="userRole">Administrador</div>
                </div>
            </div>
            <button class="logout-btn" id="logoutBtn">
                <span class="logout-icon">üö™</span>
                <span class="logout-text">Cerrar Sesi√≥n</span>
            </button>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Header -->
        <header class="header">
            <div class="header-left">
                <button class="mobile-menu-btn" id="mobileMenuBtn">
                    <span class="menu-icon">‚ò∞</span>
                </button>
                <h1 class="page-title">Gesti√≥n de Pr√©stamos</h1>
            </div>
            <div class="header-right">
                <div class="search-box">
                    <span class="search-icon">üîç</span>
                    <input type="text" placeholder="Buscar pr√©stamo..." class="search-input" id="globalSearch">
                </div>
                <button class="notification-btn">
                    <span class="notification-icon">üîî</span>
                    <span class="notification-badge">3</span>
                </button>
                <div class="header-user">
                    <div class="header-avatar">üë§</div>
                </div>
            </div>
        </header>

        <!-- Stats Cards -->
        <section class="stats-grid">
            <div class="stat-card stat-blue">
                <div class="stat-icon">üí≥</div>
                <div class="stat-content">
                    <h3 class="stat-label">Total Prestado</h3>
                    <p class="stat-value" id="totalPrestado">L. 0.00</p>
                </div>
            </div>
            <div class="stat-card stat-green">
                <div class="stat-icon">‚úÖ</div>
                <div class="stat-content">
                    <h3 class="stat-label">Total Activos</h3>
                    <p class="stat-value" id="prestamosActivos">0</p>
                </div>
            </div>
            <div class="stat-card stat-orange">
                <div class="stat-icon">‚è≥</div>
                <div class="stat-content">
                    <h3 class="stat-label">Pendientes Aprobaci√≥n</h3>
                    <p class="stat-value" id="prestamosPendientes">0</p>
                </div>
            </div>
            <div class="stat-card stat-red">
                <div class="stat-icon">‚ö†Ô∏è</div>
                <div class="stat-content">
                    <h3 class="stat-label">En Mora</h3>
                    <p class="stat-value" id="prestamosEnMora">0</p>
                </div>
            </div>
        </section>

        <!-- Filters and Actions -->
        <section class="toolbar">
            <div class="toolbar-left">
                <div class="filter-group">
                    <button class="filter-btn active" data-filter="todos">
                        Todos <span class="filter-count" id="countTodos">0</span>
                    </button>
                    <button class="filter-btn" data-filter="pendiente">
                        ‚è≥ Pendientes <span class="filter-count" id="countPendiente">0</span>
                    </button>
                    <button class="filter-btn" data-filter="aprobado">
                        ‚úÖ Aprobados <span class="filter-count" id="countAprobado">0</span>
                    </button>
                    <button class="filter-btn" data-filter="rechazado">
                        ‚ùå Rechazados <span class="filter-count" id="countRechazado">0</span>
                    </button>
                    <button class="filter-btn" data-filter="pagado">
                        üíö Pagados <span class="filter-count" id="countPagado">0</span>
                    </button>
                </div>
            </div>
            <div class="toolbar-right">
                <button class="btn-secondary" id="btnCalculadora">
                    <span class="btn-icon">üßÆ</span>
                    Calculadora
                </button>
                <button class="btn-primary" id="btnNuevoPrestamo">
                    <span class="btn-icon">‚ûï</span>
                    Nuevo Pr√©stamo
                </button>
            </div>
        </section>

        <!-- Table -->
        <section class="table-section">
            <div class="table-container">
                <table class="data-table" id="prestamosTable">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Solicitante</th>
                            <th>Tipo</th>
                            <th>Monto</th>
                            <th>Tasa Inter√©s</th>
                            <th>Plazo</th>
                            <th>Cuota Mensual</th>
                            <th>Estado</th>
                            <th>Fecha Solicitud</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="prestamosTableBody">
                        <tr class="loading-row">
                            <td colspan="10">
                                <div class="loading-spinner"></div>
                                <p>Cargando pr√©stamos...</p>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>
    </main>

    <!-- Modal: Nuevo Pr√©stamo -->
    <div class="modal" id="modalNuevoPrestamo">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2 class="modal-title">Nueva Solicitud de Pr√©stamo</h2>
                <button class="modal-close" id="btnCloseNuevo">‚úï</button>
            </div>
            <form id="formNuevoPrestamo">
                <div class="modal-body">
                    <!-- Solicitante -->
                    <div class="form-section">
                        <h3 class="section-title">Informaci√≥n del Solicitante</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="id_socio">Socio/Cliente *</label>
                                <select id="id_socio" name="id_socio" required>
                                    <option value="">Seleccionar...</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="id_cuenta">Cuenta para Desembolso *</label>
                                <select id="id_cuenta" name="id_cuenta" required>
                                    <option value="">Primero seleccione un solicitante</option>
                                </select>
                            </div>
                        </div>
                        <div id="infoSolicitante" class="info-box info-blue" style="display: none;">
                            <span class="info-icon">‚ÑπÔ∏è</span>
                            <div>
                                <strong>Informaci√≥n del Solicitante:</strong>
                                <p id="textoInfoSolicitante"></p>
                            </div>
                        </div>
                    </div>

                    <!-- Detalles del Pr√©stamo -->
                    <div class="form-section">
                        <h3 class="section-title">Detalles del Pr√©stamo</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="monto">Monto Solicitado (L.) *</label>
                                <input type="number" id="monto" name="monto" 
                                       step="0.01" min="1000" required>
                                <small class="form-help">M√≠nimo L. 1,000.00</small>
                            </div>
                            <div class="form-group">
                                <label for="plazo_meses">Plazo (meses) *</label>
                                <select id="plazo_meses" name="plazo_meses" required>
                                    <option value="6">6 meses</option>
                                    <option value="12" selected>12 meses</option>
                                    <option value="18">18 meses</option>
                                    <option value="24">24 meses</option>
                                    <option value="36">36 meses</option>
                                    <option value="48">48 meses</option>
                                    <option value="60">60 meses</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="tasa_interes">Tasa de Inter√©s Anual (%) *</label>
                                <input type="number" id="tasa_interes" name="tasa_interes" 
                                       step="0.01" min="0" value="12.00" required>
                                <small class="form-help" id="helperTasa">Tasa recomendada para socios: 8-12%</small>
                            </div>
                            <div class="form-group">
                                <label for="proposito">Prop√≥sito del Pr√©stamo *</label>
                                <select id="proposito" name="proposito" required>
                                    <option value="">Seleccionar...</option>
                                    <option value="personal">Pr√©stamo Personal</option>
                                    <option value="vivienda">Vivienda</option>
                                    <option value="vehiculo">Veh√≠culo</option>
                                    <option value="educacion">Educaci√≥n</option>
                                    <option value="negocio">Negocio</option>
                                    <option value="emergencia">Emergencia</option>
                                    <option value="otro">Otro</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Calculadora de Cuota -->
                    <div class="form-section">
                        <h3 class="section-title">Resumen del Pr√©stamo</h3>
                        <div class="prestamo-preview">
                            <div class="preview-grid">
                                <div class="preview-item">
                                    <div class="preview-label">Monto a Prestar</div>
                                    <div class="preview-value" id="previewMonto">L. 0.00</div>
                                </div>
                                <div class="preview-item">
                                    <div class="preview-label">Cuota Mensual</div>
                                    <div class="preview-value preview-highlight" id="previewCuota">L. 0.00</div>
                                </div>
                                <div class="preview-item">
                                    <div class="preview-label">Total a Pagar</div>
                                    <div class="preview-value" id="previewTotal">L. 0.00</div>
                                </div>
                                <div class="preview-item">
                                    <div class="preview-label">Total Intereses</div>
                                    <div class="preview-value" id="previewIntereses">L. 0.00</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Descripci√≥n Adicional -->
                    <div class="form-section">
                        <div class="form-group">
                            <label for="descripcion">Descripci√≥n Adicional</label>
                            <textarea id="descripcion" name="descripcion" rows="3" 
                                      placeholder="Informaci√≥n adicional sobre el pr√©stamo..."></textarea>
                        </div>
                    </div>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn-secondary" id="btnCancelarNuevo">Cancelar</button>
                    <button type="submit" class="btn-primary">
                        <span class="btn-icon">üíæ</span>
                        Crear Solicitud
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal: Detalles de Pr√©stamo -->
    <div class="modal" id="modalDetalles">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2 class="modal-title">Detalles del Pr√©stamo</h2>
                <button class="modal-close" id="btnCloseDetalles">‚úï</button>
            </div>
            <div class="modal-body">
                <div class="details-header">
                    <div class="details-icon">üí≥</div>
                    <div class="details-info">
                        <h3 id="detallesId">Pr√©stamo #---</h3>
                        <p id="detallesSolicitante">---</p>
                        <div class="details-badges">
                            <span class="badge" id="detallesEstado">---</span>
                            <span class="badge" id="detallesProposito">---</span>
                        </div>
                    </div>
                    <div class="details-monto">
                        <div class="monto-grande" id="detallesMonto">L. 0.00</div>
                        <div class="monto-label">Monto del Pr√©stamo</div>
                    </div>
                </div>

                <div class="tabs">
                    <button class="tab-btn active" data-tab="informacion">Informaci√≥n</button>
                    <button class="tab-btn" data-tab="pagos">Historial de Pagos</button>
                    <button class="tab-btn" data-tab="plan">Plan de Pagos</button>
                </div>

                <div class="tab-content active" id="tabInformacion">
                    <div class="details-grid" id="detallesInformacion">
                        <!-- Se llenar√° din√°micamente -->
                    </div>
                </div>

                <div class="tab-content" id="tabPagos">
                    <div class="pagos-container">
                        <table class="pagos-table">
                            <thead>
                                <tr>
                                    <th>Fecha</th>
                                    <th>N¬∫ Cuota</th>
                                    <th>Monto Pagado</th>
                                    <th>Saldo Restante</th>
                                    <th>Estado</th>
                                </tr>
                            </thead>
                            <tbody id="pagosBody">
                                <tr>
                                    <td colspan="5" style="text-align: center; padding: 2rem;">
                                        Cargando pagos...
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="tab-content" id="tabPlan">
                    <div class="plan-container">
                        <table class="plan-table">
                            <thead>
                                <tr>
                                    <th>N¬∫</th>
                                    <th>Fecha Vencimiento</th>
                                    <th>Cuota</th>
                                    <th>Capital</th>
                                    <th>Inter√©s</th>
                                    <th>Saldo Pendiente</th>
                                </tr>
                            </thead>
                            <tbody id="planBody">
                                <!-- Se generar√° din√°micamente -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" id="btnCerrarDetalles">Cerrar</button>
                <button class="btn-warning" id="btnRechazar" style="display: none;">
                    <span class="btn-icon">‚ùå</span>
                    Rechazar
                </button>
                <button class="btn-success" id="btnAprobar" style="display: none;">
                    <span class="btn-icon">‚úÖ</span>
                    Aprobar
                </button>
                <button class="btn-primary" id="btnImprimirPrestamo">
                    <span class="btn-icon">üñ®Ô∏è</span>
                    Imprimir
                </button>
            </div>
        </div>
    </div>

    <!-- Modal: Calculadora -->
    <div class="modal" id="modalCalculadora">
        <div class="modal-content modal-medium">
            <div class="modal-header">
                <h2 class="modal-title">Calculadora de Pr√©stamos</h2>
                <button class="modal-close" id="btnCloseCalculadora">‚úï</button>
            </div>
            <div class="modal-body">
                <div class="form-section">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="calc_monto">Monto (L.)</label>
                            <input type="number" id="calc_monto" step="0.01" min="0" value="10000">
                        </div>
                        <div class="form-group">
                            <label for="calc_plazo">Plazo (meses)</label>
                            <input type="number" id="calc_plazo" min="1" value="12">
                        </div>
                        <div class="form-group">
                            <label for="calc_tasa">Tasa Anual (%)</label>
                            <input type="number" id="calc_tasa" step="0.01" min="0" value="12">
                        </div>
                        <div class="form-group">
                            <button type="button" class="btn-primary" id="btnCalcular" style="margin-top: 1.5rem;">
                                Calcular
                            </button>
                        </div>
                    </div>
                </div>

                <div class="calc-results" id="calcResults" style="display: none;">
                    <div class="result-grid">
                        <div class="result-item">
                            <div class="result-label">Cuota Mensual</div>
                            <div class="result-value highlight" id="resultCuota">L. 0.00</div>
                        </div>
                        <div class="result-item">
                            <div class="result-label">Total a Pagar</div>
                            <div class="result-value" id="resultTotal">L. 0.00</div>
                        </div>
                        <div class="result-item">
                            <div class="result-label">Total Intereses</div>
                            <div class="result-value" id="resultIntereses">L. 0.00</div>
                        </div>
                        <div class="result-item">
                            <div class="result-label">Costo Efectivo</div>
                            <div class="result-value" id="resultCosto">0%</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="dashboard.js"></script>
    <script src="prestamos.js"></script>
</body>
</html>
